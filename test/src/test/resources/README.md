# Testing resources

## CI/CD
### Testing ArgoCD behavior locally

**NOTE** 
* If you do not have a Personal Access Token (PAT) from GitHub, you will need to [generate one](https://docs.github.com/en/enterprise-server@3.4/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token) in order
to allow ArgoCD to connect to the necessary repositories. 
* The directions below assume you have added the argo helm repo. If not run ```helm repo add argo https://argoproj.github.io/argo-helm```

1. Deploy ArgoCD
   ```
   tilt up -f test/src/test/resources/Tiltfile.cicd
   ```
2. Get the autogenerated password
   ```
   test/src/test/resources/get-argo-password.sh
   ```
3. Log into ArgoCD at **localhost:4002** with username/password of **admin/{PASSWORD_FROM_ABOVE}**
4. Add the Git and Helm Repos
   1. Select the Settings icon on the left and choose `Repositories` -> `+ CONNECT REPO USING HTTPS` and set the following values
      1. **Type**: git
      2. **Repository URL**: https://github.com/boozallen/aissemble
      3. **Username**: Your GitHub username
      4. **Password**: Your GitHub PAT
   2. After filling out the values, press `CONNECT`
   3. Select the Settings icon on the left and choose `Repositories` -> `+ CONNECT REPO USING HTTPS` and set the following values
      1. **Type**: helm
      2. **Repository URL**: <NB: OSS: replace with aissemble helm URL> 
      3. After filling out the values, press `CONNECT` and return to the Applications page
5. Select `+ NEW APP` at the top of the screen and choose `EDIT AS YAML`
6. Enter the following yaml file into the definition and press `SAVE`
   ```yaml
   apiVersion: argoproj.io/v1alpha1
   kind: Application
   metadata:
     name: test-app
   spec:
     destination:
       name: ''
       namespace: default
       server: 'https://kubernetes.default.svc'
     source:
       path: test/src/test/resources/test-app
       repoURL: 'https://github.com/boozallen/aissemble.git'
       targetRevision: dev # CAN UPDATE TO A DEVELOPMENT BRANCH PUSHED UP TO THE REMOTE FOR TESTING
       helm:
         valueFiles:
           - values.yaml
           - values-dev.yaml
     project: default
   ```
7. Select `CREATE` and then `SYNC` on the test-app project -> `SYNCHRONIZE` 
8. After the apps synchronize, validate behavior of the applications as normal. For the example hello-world application
   simply go to http://localhost:8081/hello and verify the response `Hello from RESTEasy Reactive` is returned 